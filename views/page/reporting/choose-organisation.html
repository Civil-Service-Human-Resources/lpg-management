{% from "../../component/reporting/macro.njk" import reporting with context %}
{% from "radios/macro.njk" import govukRadios %}
{% from "select/macro.njk" import govukSelect %}
{% from "button/macro.njk" import govukButton %}
{% from "error-summary/macro.njk" import govukErrorSummary %}

{% extends "../../component/Page.njk" %}

{% block pageTitle %}Reporting - Choose organisation - {{i18n['proposition_name'] }}{% endblock %}

{% block content %}

{% set typeAheadHtml %}

<div class="govuk-form-group">
  <label class="govuk-label" for="other-organisation-dropdown">
    Organisation
  </label>
  <div class="autocomplete-wrapper autocomplete-wrapper-organisations ">

    <select class="autocomplete__organisations" name="organisationId" id="parent">
      <option value="" selected></option>
      {% for organisation in organisationListForTypeAhead %}
      <option value={{ organisation.id }}>{{ organisation.formattedName }}</option>
      {% endfor %}
    </select>
  </div>
</div>

{% endset -%}

{% if sessionFlash.errors %}
    {{ govukErrorSummary({
        titleText: "There is a problem",
        errorList: [
            {
                text: sessionFlash.errors[0],
                href: "#parent"
            }
        ]
    }) }}
{% endif %}

<div class="govuk-grid row">
  <div class="govuk-column-full">
    <h1 class="govuk-heading-l">{{pageTitle}}</h1>
  </div>
</div>
<div class="govuk-grid row">
  <div class="govuk-column-one-third">
    <div class="govuk-form-group">
      <form action="/reporting/course-completions/choose-organisation" method="post">          
          {{ govukRadios({
            name: "organisation",
            fieldset: {
              legend: {
                text: "Select an organisation",
                isPageHeading: true,
                classes: "govuk-fieldset__legend--l"
              }
            },
            hint: {
              text: "Which organisation would you like to report on?"
            },
            items: [
              {
                value: firstOrganisationOption.id,
                text: firstOrganisationOption.name
              },
              {
                value: "other",
                text: "Other organisation",
                conditional: {
                  html: typeAheadHtml
                }
              }
            ].filter(item => showTypeaheadOption || item.value !== "other")
          }) }}

          {{ govukButton({
            text: "Continue to course selection",
            preventDoubleClick: true
          }) }}
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block bodyEnd %}
<script src="/govuk-frontend/all.js"></script>
<script>window.GOVUKFrontend.initAll()</script>
<script type="text/javascript" src="/js/accessible-autocomplete.min.js"></script>
<script type="text/javascript" src="/js/manage-orgs.js"></script>
{% endblock %}